<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Miss√£o Terra ‚Äî N√∫meros que Salvam</title>
<style>
:root{
  --bg1:#1e293b; --bg2:#1a4d5c; --bg3:#23a06b;
  --glass:rgba(255,255,255,.1);
  --primary:#38d9a9; --accent:#7ab8ff; --warn:#ffe066;
  --danger:#ef233c; --ok:#80ff72;
  --card-radius:20px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:#eaf4ff; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  background:linear-gradient(160deg,var(--bg1),var(--bg2) 40%,var(--bg3) 100%);
  min-height:100vh;
}
header.appbar{
  position:fixed; inset:0 0 auto 0; height:58px; display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; backdrop-filter:blur(10px); background:linear-gradient(180deg,rgba(0,0,0,.22),rgba(0,0,0,.07));
  border-bottom:1px solid rgba(255,255,255,.09); z-index:100;
}
.brand{display:flex; align-items:center; gap:10px; font-weight:700}
.coins{display:flex; align-items:center; gap:7px; padding:5px 10px; border-radius:12px; background:var(--glass)}
.coins i{font-style:normal}
.top-actions{display:flex; gap:7px}
.iconbtn{
  border:none; background:var(--glass); color:#fff; padding:8px 12px; border-radius:14px; cursor:pointer;
  transition:.15s transform,.2s box-shadow;
}
.iconbtn:hover{transform:scale(1.08)}
.iconbtn:active{transform:scale(.97)}

main {
  margin-top: 58px; /* empurra o conte√∫do abaixo do header fixo */
  overflow: auto;
  padding: 18px; /* padding mais confort√°vel, n√£o exagerado */
  display: grid;
  place-items: center;
  width: 100vw;
  min-height: calc(100vh - 58px);
  /* evita que o bot√£o flutuante/l√°bio do aparelho cubra o conte√∫do */
  padding-bottom: max(24px, env(safe-area-inset-bottom, 0px) + 90px);
}

.screen{display:none; width:100%; max-width:480px; margin:auto; min-height:calc(100vh - 120px); padding:12px}
.screen.active{display:block; animation:fade .3s}
@keyframes fade{from{opacity:.3;transform:translateY(6px)}to{opacity:1;transform:none}}

.glass{
  background:linear-gradient(180deg,rgba(255,255,255,.13),rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.15); border-radius:var(--card-radius);
  padding:16px 16px 18px 16px; box-shadow:0 6px 24px rgba(0,0,0,.22),inset 0 1px 0 rgba(255,255,255,.1);
}

.hero{display:grid; place-items:center; gap:12px; text-align:center}

.earth-wrap{width:100%; max-width:320px; margin:auto; position:relative}
.earth{
  width:100%; height:auto; display:block; margin:auto; aspect-ratio:1/1;
  animation:float 3.5s ease-in-out infinite;
}

body {
  /* ...seu c√≥digo existente... */
  background-attachment: fixed;
  background-size: cover;
  background-repeat: no-repeat;
}
body::before {
  /* ...seu c√≥digo existente... */
  position: fixed; /* mant√©m o fundo parado */
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 0;
}

@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-18px)}}
.eyes{animation:blink 5s infinite}
@keyframes blink{0%,96%,100%{transform:scaleY(1)}97%,99%{transform:scaleY(.1)}}
.shine{
  position:absolute; inset:0; pointer-events:none;
  background:radial-gradient(250px 170px at 24% 25%, rgba(255,255,255,.23), transparent 60%);
  border-radius:50%; mix-blend-mode:screen; animation:shineMove 6s ease-in-out infinite;
}
@keyframes shineMove{0%,100%{transform:translate(0,0)}50%{transform:translate(7px,-11px)}}

/* ====== BOTOES PRINCIPAIS (garantir que os 3 apare√ßam) ====== */
.grid3{
  display:flex; flex-wrap:wrap; gap:10px; width:100%; justify-content:center
}
.grid3 .cta{flex:1 1 240px; min-width:160px}

/* ====== Buttons & inputs ====== */
.cta{
  border:none; border-radius:14px; padding:12px 14px; color:#1e293b; font-weight:700; letter-spacing:.2px;
  background:linear-gradient(180deg,#e9f7ff,#bfe1ff); cursor:pointer;
  box-shadow:0 6px 18px rgba(22,110,167,.22),inset 0 1px 0 rgba(255,255,255,.92);
  margin:4px; font-size:1.08rem; transition:.13s transform,.2s box-shadow;
}
.cta:hover{transform:translateY(-2px); box-shadow:0 12px 28px rgba(22,110,167,.32)}
.cta:active{transform:scale(.98)}
.cta.accent{background:linear-gradient(180deg,#d1ffe7,#89f3bd)}
.cta.warn{background:linear-gradient(180deg,#fff1d6,#ffd27a)}
.cta.danger{background:linear-gradient(180deg,#ffd4d4,#ff9d9d)}
.cta.dark{
  background:linear-gradient(180deg,#27324b,#1b2338); color:#eaf4ff; border:1px solid rgba(255,255,255,.1);
  box-shadow:0 10px 24px rgba(0,0,0,.35);
}

.field{display:flex; flex-direction:column; gap:7px; margin:7px 0 13px}
.input{
  padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.07); color:#fff;
  outline:none; box-shadow:inset 0 1px 0 rgba(255,255,255,.09);
}
.helper{opacity:.85; font-size:.98rem}

/* Quiz */
.quiz-wrap{display:grid; gap:13px}
.question{font-size:1.12rem; line-height:1.5}
.answers{display:grid; gap:8px}
.ans{
  text-align:left; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12); cursor:pointer;
  background:linear-gradient(180deg,rgba(255,255,255,.09),rgba(255,255,255,.03));
  transition:.13s transform,.22s border,.22s background,.22s box-shadow;
}
.ans:hover{transform:translateY(-2px); border-color:rgba(255,255,255,.28)}
.ans.selected{background:var(--glass); border-color:var(--accent)}
.proj{font-size:.97rem; opacity:.95; border-left:3px solid rgba(255,255,255,.2); padding-left:11px}
.progress{height:7px; border-radius:999px; background:rgba(255,255,255,.17); overflow:hidden}
.bar{height:100%; width:0%; background:linear-gradient(90deg,#38d9a9,#7ab8ff); transition:width .28s}

/* Cards & grids */
.lvlgrid{display:grid; grid-template-columns:1fr; gap:10px; margin-top:7px}
.level-card{padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg,rgba(255,255,255,.09),rgba(255,255,255,.03))}
.tag{font-size:.88rem; opacity:.85}
.pill{display:inline-block; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.14)}
.center{display:grid; place-items:center}

/* Curiosidades - bot√£o flutuante e card animado */
#curioBtn{
  position:fixed; left:18px; bottom:24px; z-index:999;
  width:56px; height:56px; background:linear-gradient(180deg,#ffe066 80%,#fffbe6 100%);
  box-shadow:0 7px 24px #2224,0 0 0 5px #ffe06680;
  border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;
  animation:floatLamp 2s infinite alternate; border:none;
}
@keyframes floatLamp{0%{transform:translateY(0)}100%{transform:translateY(-12px)}}
#curioBtn .led{
  position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
  width:16px; height:8px; border-radius:8px;
  background:radial-gradient(circle at 50% 50%, #fffde6 70%, #ffe066 100%);
  box-shadow:0 0 12px 5px #ffee77; opacity:.7;
}
#curioBtn img{width:36px; height:36px; filter:drop-shadow(0 0 2px #fff8)}

#curioCurios{
  position:fixed; left:3vw; bottom:110px; z-index:1000;
  min-width:85vw; max-width:98vw; max-height:60vh;
  background:linear-gradient(180deg,#fffbe6 96%,#ffe066 100%);
  border-radius:26px; box-shadow:0 7px 28px #2228; border:2px solid #ffe066;
  padding:12px 7px 12px 12px; font-size:1.08rem; color:#222;
  display:none; overflow-y:auto; animation:slideCurio .5s;
}
@keyframes slideCurio{from{transform:translateY(70px);opacity:0}to{transform:none;opacity:1}}
#curioCurios h3{margin:0 0 8px 0; font-size:1.15rem; color:#bba600; text-align:left}
#curioCurios .closeCurio{
  position:absolute; top:9px; right:18px; font-size:1.3rem; background:none; border:none; color:#bba600; cursor:pointer; transition:.2s;
}
#curioCurios .closeCurio:hover{color:#222}
#curioCurios ul{margin:8px 0 0 0; padding:0 0 0 18px}
#curioCurios li{margin-bottom:7px}

/* breakpoints */
@media (min-width: 700px){
  .screen{max-width:520px}
  .lvlgrid{grid-template-columns:repeat(2,1fr)}
  #curioCurios{min-width:320px;max-width:360px;left:20px}
  #curioBtn{width:68px;height:68px}
}
@media (min-width: 1000px){
  .screen{max-width:560px}
  .lvlgrid{grid-template-columns:repeat(2,1fr)}
  #curioCurios{min-width:320px;max-width:360px;left:28px}
}
</style>
</head>
<body>
<header class="appbar">
  <div class="brand"><span style="font-size:22px">üåé</span> <span>Miss√£o Terra</span></div>
  <div class="coins"><i>‚≠ê</i> <span id="coins">0</span></div>
  <div class="top-actions">
    <button class="iconbtn" title="Configura√ß√µes" onclick="go('settings')">‚öôÔ∏è</button>
    <button class="iconbtn" title="Roupas" onclick="go('wardrobe')">üß¢</button>
    <button class="iconbtn" title="Sair" onclick="logout()">üö™</button>
  </div>
</header>

<main>
  <!-- LOGIN -->
  <section id="login" class="screen active">
    <div class="glass login-card">
      <h1 style="margin:6px 0 2px">Bem-vindo(a) ao <span style="color:var(--primary)">Miss√£o Terra</span>!</h1>
      <p class="helper">Entre para salvar o planeta jogando e aprendendo. üå±</p>
      <div class="field">
        <label for="nickname">Seu nome</label>
        <input id="nickname" class="input" placeholder="Digite seu nome..."/>
      </div>
      <button class="cta accent" style="width:100%" onclick="doLogin()">Entrar</button>
    </div>
  </section>

  <!-- HOME -->
  <section id="home" class="screen">
    <div class="hero">
      <div class="grid3">
        <button class="cta dark" onclick="go('settings')">‚öôÔ∏è Configura√ß√µes</button>
        <button class="cta dark" onclick="go('wardrobe')">üß¢ Roupas</button>
        <button class="cta dark" onclick="logout()">üö™ Sair</button>
      </div>

      <div class="earth-wrap">
        <!-- Mascote animado -->
        <svg class="earth" viewBox="0 0 200 200" aria-hidden="true">
          <defs>
            <radialGradient id="ocean" cx="50%" cy="45%" r="55%">
              <stop offset="0%" stop-color="#7ccaff"/>
              <stop offset="60%" stop-color="#2a7bd9"/>
              <stop offset="100%" stop-color="#1346a6"/>
            </radialGradient>
            <radialGradient id="shine" cx="35%" cy="30%" r="70%">
              <stop offset="0%" stop-color="rgba(255,255,255,.23)"/>
              <stop offset="60%" stop-color="rgba(255,255,255,.08)"/>
              <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
            </radialGradient>
            <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#2a3b72" flood-opacity="0.5"/>
            </filter>
          </defs>
          <circle cx="100" cy="100" r="90" fill="url(#ocean)" filter="url(#shadow)"/>
          <g class="eyes">
            <ellipse cx="72" cy="90" rx="13" ry="19" fill="#222"/>
            <ellipse cx="128" cy="90" rx="13" ry="19" fill="#222"/>
            <ellipse cx="72" cy="98" rx="6" ry="9" fill="#fff" opacity=".7"/>
            <ellipse cx="128" cy="98" rx="6" ry="9" fill="#fff" opacity=".7"/>
          </g>
          <path d="M70,140 Q100,180 130,140" stroke="#222" stroke-width="7" fill="none" stroke-linecap="round"/>
          <circle cx="62" cy="118" r="7" fill="#ffb3c1"/>
          <circle cx="138" cy="118" r="7" fill="#ffb3c1"/>
          <!-- Itens -->
          <g id="layer-leafHat" style="display:none">
            <path d="M55,60 Q100,18 145,60 Q120,50 100,58 Q80,53 55,60Z" fill="#23a06b" stroke="#158052" stroke-width="3"/>
          </g>
          <g id="layer-ecoGlasses" style="display:none">
            <rect x="63" y="82" rx="7" ry="7" width="24" height="16" fill="rgba(0,0,0,.18)" stroke="#38d9a9" stroke-width="3"/>
            <rect x="113" y="82" rx="7" ry="7" width="24" height="16" fill="rgba(0,0,0,.18)" stroke="#38d9a9" stroke-width="3"/>
            <rect x="87" y="89" width="26" height="5" fill="#38d9a9"/>
          </g>
          <g id="layer-greenCape" style="display:none">
            <path d="M100,155 Q65,175 45,190 Q155,190 135,175 Q100,155 100,155Z" fill="#23a06b" opacity=".72"/>
          </g>
          <circle cx="70" cy="60" r="32" fill="url(#shine)" opacity=".5"/>
        </svg>
        <div class="shine" aria-hidden="true"></div>
      </div>

      <!-- 3 bot√µes principais -->
      <div class="grid3">
        <button class="cta accent" onclick="go('select')">üéÆ Jogar</button>
        <button class="cta warn" onclick="resetGame()">‚ôªÔ∏è Reset</button>
        <button class="cta" onclick="go('store')">üõí Loja</button>
      </div>
    </div>
  </section>

  <!-- SELETOR DE N√çVEL -->
  <section id="select" class="screen">
    <div class="glass">
      <h2>Escolha um n√≠vel</h2>
      <p class="helper">Cada n√≠vel tem 1 pergunta. Ganhe ‚≠ê b√¥nus conforme sua escolha!</p>
      <div class="lvlgrid" id="levelGrid"></div>
      <div style="margin-top:10px; display:flex; gap:7px; flex-wrap:wrap">
        <button class="cta dark" onclick="go('home')">‚¨ÖÔ∏è Voltar</button>
        <button class="cta" onclick="resetProgressConfirm()">üîÑ Resetar progresso do quiz</button>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="quiz" class="screen">
    <div class="glass quiz-wrap">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
        <div>
          <div class="tag">N√≠vel</div>
          <h3 id="quizLevel">‚Äî</h3>
        </div>
        <div style="min-width:160px;flex:1">
          <div class="tag">Progresso</div>
          <div class="progress"><div class="bar" id="bar"></div></div>
        </div>
        <div class="pill" id="qIndicator">Pergunta 1/1</div>
      </div>
      <div class="question" id="question">‚Äî</div>
      <div class="answers" id="answers"></div>
      <div id="projection" class="proj" style="display:none"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="cta dark" onclick="prevQuestion()">‚¨ÖÔ∏è Tentar novamente</button>
        <button class="cta accent" onclick="nextQuestion()">Pr√≥xima ‚û°Ô∏è</button>
        <button class="cta" onclick="exitQuiz()">Sair do n√≠vel</button>
      </div>
    </div>
  </section>

  <!-- FINAL -->
  <section id="final" class="screen center" style="display:none">
    <div class="glass" style="max-width:720px">
      <h2>Parab√©ns!</h2>
      <p>Sua escolha: <span id="finalChoice"></span></p>
      <p>Voc√™ ganhou <span id="finalCoins"></span> ‚≠ê!</p>
      <button class="cta accent" onclick="go('home')">Voltar ao in√≠cio</button>
    </div>
  </section>

  <!-- LOJA -->
  <section id="store" class="screen">
    <div class="glass">
      <h2>Loja</h2>
      <p class="helper">Troque ‚≠ê por itens para o mascote.</p>
      <div class="lvlgrid" id="storeGrid"></div>
      <div style="margin-top:10px"><button class="cta dark" onclick="go('home')">‚¨ÖÔ∏è Voltar</button></div>
    </div>
  </section>

  <!-- ROUPAS -->
  <section id="wardrobe" class="screen">
    <div class="glass">
      <h2>Roupas</h2>
      <p class="helper">Ative/desative os itens comprados pro mascote. Voc√™ pode combinar itens.</p>
      <div class="lvlgrid" id="wardrobeGrid"></div>
      <div style="margin-top:10px"><button class="cta dark" onclick="go('home')">‚¨ÖÔ∏è Voltar</button></div>
    </div>
  </section>

  <!-- CONFIG -->
  <section id="settings" class="screen">
    <div class="glass">
      <h2>Configura√ß√µes</h2>
      <div class="field">
        <label>Nome</label>
        <input id="nameEdit" class="input" placeholder="Seu nome"/>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="cta accent" onclick="saveSettings()">Salvar</button>
        <button class="cta" onclick="go('home')">Voltar</button>
        <button class="cta danger" onclick="logout()">Sair da conta</button>
      </div>
    </div>
  </section>

  <!-- Bot√£o flutuante de curiosidades -->
  <button id="curioBtn" title="Curiosidades">
    <img src="https://img.icons8.com/fluency/48/000000/light-on.png" alt="L√¢mpada"/>
    <span class="led"></span>
  </button>
  <div id="curioCurios" role="dialog" aria-modal="true" aria-labelledby="curioTitle">
    <button class="closeCurio" onclick="toggleCurio(false)" aria-label="Fechar">‚úñ</button>
 <h3 id="curioTitle">Curiosidades</h3>
<ul>
  <li>1. A mudan√ßa clim√°tica n√£o √© apenas uma coisa do futuro. Embora as mudan√ßas de curto prazo possam ser menos extremas do que as mudan√ßas projetadas para 2100, a altera√ß√£o no clima j√° est√° ocorrendo e os riscos nos pr√≥ximos 50 anos podem ser significativamente diferentes dos riscos atuais.</li>
  <li>2. O di√≥xido de carbono constitui apenas 3,6% do total de gases de efeito estufa, dos quais 0,12% s√£o atribu√≠dos √†s atividades humanas.</li>
  <li>3. Devido ao efeito estufa, a temperatura m√©dia da Terra √© de 15¬∞C ao inv√©s de -18¬∞C.</li>
  <li>4. A temperatura m√©dia global √© atualmente de 14¬∞C. Os cientistas preveem que ela pode subir outros 6¬∞C no s√©culo 21, se nada for modificado.</li>
  <li>5. Normalmente, a luz solar irradia atrav√©s da atmosfera da Terra e aquece a superf√≠cie, depois volta ao espa√ßo. O aquecimento global ocorre quando o calor √© retido pelos gases do efeito estufa e, em vez de irradiar de volta, continua a aquecer a superf√≠cie da Terra, elevando as temperaturas.</li>
  <li>6. A temperatura global m√©dia sobre as superf√≠cies terrestres e oce√¢nicas de 2014 foi a maior de todos os anos, desde o in√≠cio dos registros em 1880.</li>
  <li>7. O buraco da camada de oz√¥nio n√£o tem muito a ver com a mudan√ßa clim√°tica. Ele consiste no afinamento da camada de mol√©culas de oz√¥nio na atmosfera, causado por clorofluorcarbonos que costumavam ser usados de forma generalizada na fabrica√ß√£o. A camada de oz√¥nio impede que muitos raios ultravioleta atinjam a Terra.</li>
  <li>8. De acordo com o Programa Mundial de Alimentos (WPF.org), 375 milh√µes de pessoas s√£o afetadas anualmente por desastres causados por mudan√ßas clim√°ticas.</li>
  <li>9. Nos √∫ltimos 50 anos, a concentra√ß√£o de di√≥xido de carbono na atmosfera aumentou em 30% devido √† queima de combust√≠veis f√≥sseis e emiss√µes de gases de efeito estufa, como di√≥xido de carbono, √≥xido nitroso e outros gases, aprisionando mais calor na baixa atmosfera.</li>
  <li>10. O aumento das temperaturas causar√° mais mortes, n√£o por raz√µes naturais, mas como resultado de superaquecimento e dissemina√ß√£o r√°pida de doen√ßas mortais.</li>
  <li>11. Os pre√ßos dos alimentos aumentaram e continuar√£o a subir cerca de 60% at√© 2030, devido aos efeitos das mudan√ßas clim√°ticas nas lavouras e na pecu√°ria.</li>
  <li>12. Muitas doen√ßas tamb√©m s√£o provocadas pela contamina√ß√£o da √°gua transportada para √°reas atingidas pela seca.</li>
  <li>13. Os principais gases de efeito estufa s√£o: di√≥xido de carbono (CO‚ÇÇ), metano (CH‚ÇÑ) e √≥xido nitroso (N‚ÇÇO).</li>
</ul>
  </div>
</main>

<script>
/* ===== Utils ===== */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

const STORAGE_KEY = 'missaoTerra_v3';
const state = {
  user:null, coins:0,
  items:{
    leafHat:   {owned:false,on:false,name:'Chap√©u Folha',price:30},
    ecoGlasses:{owned:false,on:false,name:'√ìculos Sustent√°vel',price:50},
    greenCape: {owned:false,on:false,name:'Capa Verde',price:40}
  },
  levelsDone:{}, progress:{},
};

function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(state)); }
function load(){
  const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return;
  try{
    const data=JSON.parse(raw);
    state.user=data.user??state.user;
    state.coins=data.coins??state.coins;
    state.levelsDone=data.levelsDone??{};
    state.progress=data.progress??{};
    if(data.items){
      Object.keys(state.items).forEach(k=>{
        if(data.items[k]) state.items[k] = {...state.items[k], ...data.items[k]};
      });
    }
  }catch{ /* ignore */ }
}

function go(id){
  $$('.screen').forEach(s=>{
    s.classList.remove('active');
    if(s.id==='final') s.style.display='none';
  });
  const el=$('#'+id);
  el.classList.add('active');
  if(id==='final') el.style.display='block';
  if(id==='select') renderLevelSelect();
  if(id==='wardrobe') renderWardrobe();
  if(id==='store') renderStore();
  if(id==='home'){ updateCoins(); applyAvatarLayers(); }
}

function logout(){
  if(confirm('Deseja sair?')){
    state.user=null; save(); go('login'); updateCoins();
  }
}

function doLogin(){
  const name=$('#nickname').value.trim();
  if(!name){alert('Digite seu nome üôÇ');return;}
  state.user=name; save(); $('#nameEdit').value=name; go('home');
}
function saveSettings(){
  const name=$('#nameEdit').value.trim();
  if(name){state.user=name;}
  save(); go('home');
}
function updateCoins(){ $('#coins').textContent = state.coins||0; }

function applyAvatarLayers(){
  ['leafHat','ecoGlasses','greenCape'].forEach(id=>{
    const layer=document.getElementById('layer-'+id);
    if(layer) layer.style.display = (state.items[id] && state.items[id].on) ? '' : 'none';
  });
}

/* ===== Loja & Guarda-roupa ===== */
function renderStore(){
  const grid=$('#storeGrid'); grid.innerHTML='';
  Object.entries(state.items).forEach(([key,info])=>{
    const card=document.createElement('div'); card.className='level-card';
    card.innerHTML=`
      <div style="font-weight:700">${info.name}</div>
      <div class="helper">Custa ${info.price} ‚≠ê</div>
      ${info.owned
        ? `<div class="pill">Comprado ‚úÖ</div>`
        : `<button class="cta" onclick="buy('${key}',${info.price})">Comprar</button>`}
    `;
    grid.appendChild(card);
  });
}
function renderWardrobe(){
  const grid=$('#wardrobeGrid'); grid.innerHTML='';
  Object.entries(state.items).forEach(([key,info])=>{
    const card=document.createElement('div'); card.className='level-card';
    card.innerHTML=`
      <div style="font-weight:700">${info.name}</div>
      <div class="helper">${info.owned?'Comprado':'N√£o comprado'}</div>
      <div style="margin-top:7px;display:flex;gap:7px;flex-wrap:wrap">
        ${info.owned
          ? `<button class="cta ${info.on?'warn':''}" onclick="toggleItem('${key}')">${info.on?'Desativar':'Ativar'}</button>`
          : `<button class="cta" onclick="go('store')">Ir √† Loja</button>`}
      </div>
    `;
    grid.appendChild(card);
  });
}
function buy(key,price){
  const it=state.items[key];
  if(!it){alert('Item inexistente');return;}
  if(it.owned){alert('Voc√™ j√° tem esse item.');return;}
  if((state.coins||0)<price){alert('Voc√™ precisa de mais ‚≠ê para comprar este item.');return;}
  state.coins-=price; it.owned=true; it.on=true;
  save(); updateCoins(); renderStore(); renderWardrobe(); applyAvatarLayers();
  alert('Comprado!');
}
function toggleItem(key){
  const it=state.items[key]; if(!it||!it.owned){alert('Compre o item primeiro na loja.');return;}
  it.on=!it.on; save(); renderWardrobe(); applyAvatarLayers();
}

/* ===== QUIZ DATA ===== */
const LEVELS = [
  {
    title: 'N√≠vel 1 - LIXO',
    theme: 'Lixo',
    qs: [{
      q: 'No Brasil, existem 3 mil lix√µes que recebem cerca de 45 milh√µes de toneladas de res√≠duos por ano, emitindo aproximadamente 27 milh√µes de toneladas de CO‚ÇÇ. Maria quer agir de forma concreta para reduzir esse impacto. O que ela deve fazer?',
      opts: [
        'A) Na casa de Maria, s√£o separados 2 kg de lixo recicl√°vel por dia e ela leva para a coleta seletiva.',
        'B) Ela usa 2 kg de lixo org√¢nico por dia para adubar hortas em casa.',
        'C) Maria n√£o faz nada e descarta todo o lixo junto.'
      ],
      coins: [10,15,5],
      proj: [
        '‚û°Ô∏è Em um ano, ela ter√° separado 2 √ó 365 = 730 kg de lixo, o que representa 730 √∑ 1000 = 0,73 toneladas. 0,73 √∑ 45.000.000 = 0,0000000162 do total de lixo nacional. Aplicando essa fra√ß√£o √†s 27 milh√µes de toneladas de CO‚ÇÇ emitidas pelos lix√µes, temos 27.000.000 √ó 0,0000000162 = 0,4374 toneladas de CO‚ÇÇ evitadas por ano se replicado em larga escala. Esta √© uma boa escolha, pois reduz a polui√ß√£o e incentiva a reciclagem.',
        '‚û°Ô∏è Em um ano, ela ter√° reaproveitado 2 √ó 365 = 730 kg de lixo, representando 730 √∑ 45.000.000 = 0,00001622 do total de res√≠duos. Aplicando essa fra√ß√£o √†s 27 milh√µes de toneladas de CO‚ÇÇ, obtemos ~437 toneladas de CO‚ÇÇ evitadas por ano se replicado em larga escala. Op√ß√£o excelente, com redu√ß√£o de GEE e adubo natural.',
        '‚û°Ô∏è Neste caso, nenhum lixo √© desviado e nenhuma tonelada de CO‚ÇÇ √© evitada, mantendo o problema ambiental.'
      ]
    }]
  },
  {
    title: 'N√≠vel 2 - ENERGIA',
    theme: 'Energia',
    qs: [{
      q: 'Elisa vai assistir a um filme na TV. Considerando que a pegada de carbono m√©dia de uma hora de v√≠deo via streaming √© de 55 g CO‚ÇÇ e que a TV LED consome 50 W. Em qual das op√ß√µes ela pode ajudar na redu√ß√£o da emiss√£o de CO‚ÇÇ?',
      opts: [
        'A) Elisa deixa a TV ligada e sai por 30 minutos.',
        'B) Elisa assiste normalmente, mas se afasta da sala por ~10 minutos.',
        'C) Elisa s√≥ liga a TV no momento exato do filme e desliga ao terminar.'
      ],
      coins: [5,10,15],
      proj: [
        '‚û°Ô∏è Consumo extra: 50 W √ó 0,5 h = 25 Wh (0,025 kWh/dia). Em 30 dias: 0,75 kWh desperdi√ßados (~825 g CO‚ÇÇ/m√™s). Pior op√ß√£o.',
        '‚û°Ô∏è Consumo extra: 50 W √ó 0,166 h ‚âà 8,3 Wh (0,0083 kWh/dia). Em 30 dias: ~0,25 kWh (~275 g CO‚ÇÇ/m√™s). Intermedi√°ria.',
        '‚û°Ô∏è Sem desperd√≠cio extra. Melhor uso de energia, menor impacto ambiental.'
      ]
    }]
  },
  {
    title: 'N√≠vel 3 - AR',
    theme: 'Ar',
    qs: [{
      q: 'Bernardo instala energia solar em casa. O sistema gera 180 kWh/m√™s. O impacto depende do uso:',
      opts: [
        'A) Sistema eficiente e uso consciente.',
        'B) Sistema parcialmente aproveitado.',
        'C) Sistema pouco aproveitado ou com desperd√≠cio.'
      ],
      coins: [15,10,5],
      proj: [
        '‚û° Aproveitando toda a energia, evita ~3,56 kg CO‚ÇÇ/dia (~1,3 t/ano ‚âà 65 √°rvores). Melhor escolha.',
        '‚û° Uso parcial: ~2 kg CO‚ÇÇ/dia (~0,73 t/ano ‚âà 36 √°rvores). Intermedi√°ria.',
        '‚û° Pouco aproveitamento: ~1 kg CO‚ÇÇ/dia (~0,36 t/ano ‚âà 18 √°rvores). Pior escolha.'
      ]
    }]
  },
  {
    title: 'N√≠vel 4 - √ÅGUA',
    theme: '√Ågua',
    qs: [{
      q: 'Um banho por dia. O gasto varia:',
      opts: [
        'A) Banho r√°pido.',
        'B) Banho moderado.',
        'C) Banho demorado.'
      ],
      coins: [15,10,5],
      proj: [
        '‚û° 5 min ‚âà 30 L/dia ‚Üí 900 L/m√™s ‚Üí 10.950 L/ano. Melhor op√ß√£o.',
        '‚û° 10 min ‚âà 60 L/dia ‚Üí 1.800 L/m√™s ‚Üí 21.900 L/ano. Intermedi√°ria.',
        '‚û° 15 min ‚âà 90 L/dia ‚Üí 2.700 L/m√™s ‚Üí 32.850 L/ano. Pior op√ß√£o.'
      ]
    }]
  }
];

/* ===== Quiz Flow ===== */
let currentLevel=0, qIndex=0, locked=false, pickedAnswer=null;

function renderLevelSelect(){
  const grid=$('#levelGrid'); grid.innerHTML='';
  LEVELS.forEach((lv,idx)=>{
    const i=idx+1, done=!!state.levelsDone[i];
    const card=document.createElement('div'); card.className='level-card';
    card.innerHTML=`
      <div class="tag">${lv.theme}</div>
      <h3 style="margin:4px 0 8px">${lv.title}</h3>
      <div style="display:flex; gap:7px; align-items:center; flex-wrap:wrap">
        <span class="pill">${done?'Conclu√≠do ‚úÖ':'1 pergunta'}</span>
        ${done?`<span class="pill">‚≠ê b√¥nus recebido</span>`:''}
      </div>
      <div style="margin-top:10px;display:flex;gap:7px;flex-wrap:wrap">
        <button class="cta accent" onclick="startLevel(${i})">Jogar</button>
        ${done?`<button class="cta" onclick="reviewLevel(${i})">Rever</button>`:''}
      </div>
    `;
    grid.appendChild(card);
  });
}
function startLevel(n){
  currentLevel=n; qIndex=0; locked=false; pickedAnswer=null;
  $('#quizLevel').textContent=LEVELS[n-1].title;
  updateQuizUI(); go('quiz');
}
function reviewLevel(n){ startLevel(n); }

function updateQuizUI(){
  const L=LEVELS[currentLevel-1], total=L.qs.length;
  qIndex=Math.max(0,Math.min(qIndex,total-1));
  const q=L.qs[qIndex];
  $('#question').textContent=q.q;
  $('#qIndicator').textContent=`Pergunta ${qIndex+1}/${total}`;
  $('#bar').style.width=`${((qIndex)/total)*100}%`;
  const ans=$('#answers'); ans.innerHTML=''; $('#projection').style.display='none';
  q.opts.forEach((text,i)=>{
    const b=document.createElement('button'); b.className='ans'; b.textContent=text;
    b.onclick=()=>pick(i);
    if(pickedAnswer===i) b.classList.add('selected');
    ans.appendChild(b);
  });
  if(pickedAnswer!==null){
    $('#projection').style.display='block';
    $('#projection').textContent=q.proj[pickedAnswer]||'';
  }
}
function pick(i){
  if(locked) return;
  pickedAnswer=i; updateQuizUI(); locked=true;
}
function nextQuestion(){
  const L=LEVELS[currentLevel-1], q=L.qs[qIndex];
  if(pickedAnswer===null){ alert('Escolha uma op√ß√£o antes de avan√ßar!'); return; }
  if(!state.levelsDone[currentLevel]){
    const coinsToAdd = q.coins[pickedAnswer];
    state.coins = (state.coins||0) + coinsToAdd;
    updateCoins();
    state.levelsDone[currentLevel]=true;
    save();
    const tipoMap = {5:'Ruim',10:'M√©dia',15:'Excelente'};
    $('#finalChoice').textContent = tipoMap[coinsToAdd] || '‚Äî';
    $('#finalCoins').textContent = coinsToAdd;
    go('final'); return;
  }
  go('select');
}
function prevQuestion(){ pickedAnswer=null; locked=false; updateQuizUI(); }
function exitQuiz(){ if(confirm('Deseja sair do n√≠vel? Progresso ser√° salvo.')) go('select'); }
function resetGame(){ if(confirm('Quer resetar tudo?')){ localStorage.removeItem(STORAGE_KEY); location.reload(); } }
function resetProgressConfirm(){
  if(confirm('Resetar progresso dos quizzes?')){ state.progress={}; state.levelsDone={}; save(); renderLevelSelect(); }
}

/* ===== Curiosidades (flutuante) ===== */
// Curiosidades: abre/fecha ao clicar na l√¢mpada ou no X
let curioOpen = false;
function toggleCurio(force) {
  const card = $('#curioCurios');
  if (typeof force === 'boolean') {
    curioOpen = force;
  } else {
    curioOpen = !curioOpen;
  }
  card.style.display = curioOpen ? 'block' : 'none';
}
$('#curioBtn').addEventListener('click', e => {
  e.stopPropagation();
  toggleCurio();
});
$('#curioCurios .closeCurio').addEventListener('click', e => {
  e.stopPropagation();
  toggleCurio(false);
});

/* ===== Init ===== */
load(); go(state.user?'home':'login'); updateCoins(); applyAvatarLayers();
</script>
</body>
</html>
